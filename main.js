(()=>{"use strict";class t{constructor(){this.trello=document.querySelector(".js-trello")}saveCards(){const t=[],e=this.trello.querySelectorAll(".js-board");for(const a of e){let e=a.querySelectorAll(".js-card");const s=[];e.length>0&&(e=Array.from(e),e.forEach((t=>{s.push(t.querySelector(".js-card-text").textContent)}))),t.push(s)}localStorage.trelloUserContent=JSON.stringify(t)}extractCards(){if(!localStorage.trelloUserContent)return;const t=JSON.parse(localStorage.trelloUserContent),e=this.trello.querySelectorAll(".js-board");t.forEach(((t,a)=>{const s=e[a].querySelector(".js-cards");t.length>0&&t.forEach((t=>{const e=document.createElement("div");e.classList.add("trello__card","js-card"),e.innerHTML='<span class="trello__card-text js-card-text"></span>',e.querySelector(".js-card-text").textContent=t,s.append(e);const a=document.createElement("div");a.classList.add("trello__delete-card","js-delete-card"),a.innerHTML="<span> + </span>",e.append(a)}))}))}}class e{constructor(){this.localStorage=new t,this.trello=document.querySelector(".js-trello"),this.draggedCard=null,this.clonedCard=null,this.offsetCardClickX=null,this.offsetCardClickY=null,this.isFirstClick=!0,this.addEventsToBoards=this.addEventsToBoards.bind(this)}init(){this.localStorage.extractCards(),this.addEventsToBoards()}addEventsToBoards(){this.trello.addEventListener("click",(t=>{if(t.preventDefault(),t.target.classList.contains("js-add-textarea")){this.removeActiveTextarea(),this.hideAddCardPanel(),this.showAddCardPanel(t.target);const e=t.target.closest(".js-board").querySelector(".js-cards"),a=document.createElement("textarea");return a.classList.add("trello__textarea","js-textarea"),e.insertAdjacentElement("afterEnd",a),void a.focus()}if(t.target.classList.contains("js-add-card-button")){const e=t.target.closest(".js-board").querySelector(".js-textarea");if(""===e.value)return;const a=t.target.closest(".js-board").querySelector(".js-cards"),s=document.createElement("div");s.classList.add("trello__card","js-card"),s.innerHTML='<span class="trello__card-text js-card-text"></span>',s.querySelector(".js-card-text").textContent=e.value,a.append(s);const r=document.createElement("div");r.classList.add("trello__delete-card","js-delete-card"),r.innerHTML="<span> + </span>",s.append(r),this.localStorage.saveCards()}t.target.classList.contains("js-delete-card")&&(t.target.closest(".js-card").remove(),this.localStorage.saveCards()),t.target.classList.contains("js-textarea")||(this.removeActiveTextarea(),this.hideAddCardPanel())}));const t=document.querySelectorAll(".js-cards");for(const e of t)e.addEventListener("mousedown",(t=>{if(t.preventDefault(),!t.target.classList.contains("js-card"))return;document.body.classList.add("_grabbing"),this.draggedCard=t.target,this.clonedCard=t.target.cloneNode(!0),this.clonedCard.classList.add("_drag"),this.clonedCard.style.width=`${this.draggedCard.offsetWidth}px`,document.body.append(this.clonedCard),this.draggedCard.classList.add("_ghost");const e=this.draggedCard.getBoundingClientRect();this.offsetCardClickX=t.pageX-e.left,this.offsetCardClickY=t.pageY-e.top,this.positionsDraggedCard(t)}));this.trello.addEventListener("mousemove",(t=>{if(t.preventDefault(),this.draggedCard){if(this.positionsDraggedCard(t),t.target.classList.contains("js-card")){const e=t.target.getBoundingClientRect(),a=t.pageY-(e.bottom-e.height/2);return a<0&&t.target.insertAdjacentElement("beforeBegin",this.draggedCard),void(a>0&&t.target.insertAdjacentElement("afterEnd",this.draggedCard))}t.target.classList.contains("js-add-textarea")&&t.target.closest(".js-board").querySelector(".js-cards").append(this.draggedCard)}})),this.trello.addEventListener("mouseleave",(t=>{this.draggedCard&&(this.draggedCard&&this.draggedCard.classList.remove("_ghost"),this.dropGrabbingCard())})),this.trello.addEventListener("mouseup",(t=>{this.draggedCard&&(this.draggedCard&&(this.draggedCard.classList.remove("_ghost"),this.localStorage.saveCards()),this.dropGrabbingCard())}))}removeActiveTextarea(){const t=document.querySelector(".js-textarea");t&&t.remove()}showAddCardPanel(t){t.classList.add("_hide");const e=t.closest(".js-board"),a=document.createElement("button");a.type="button",a.classList.add("trello__add-card-button","js-add-card-button"),a.textContent="Добавить карточку",e.insertAdjacentElement("beforeEnd",a)}hideAddCardPanel(){const t=document.querySelector(".js-add-textarea._hide"),e=document.querySelector(".js-add-card-button");t&&t.classList.remove("_hide"),e&&e.remove()}positionsDraggedCard(t){this.clonedCard.style.left=t.pageX-this.offsetCardClickX+"px",this.clonedCard.style.top=t.pageY-this.offsetCardClickY+"px"}dropGrabbingCard(){document.body.classList.remove("_grabbing"),document.body.removeChild(this.clonedCard),this.draggedCard=null,this.clonedCard=null}}document.addEventListener("DOMContentLoaded",(()=>{(new e).init()}))})();